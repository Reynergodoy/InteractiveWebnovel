var Novel=function(a,b,c){this.scene=a||0;this.scenes=b||{};this.items=c||{}};Novel.prototype.setStart=function(a){this.scene=a};Novel.prototype.addScene=function(a,b){this.scenes[a]=b};Novel.prototype.deleteScene=function(a){delete this.scenes[a]};Novel.prototype.canMove=function(a){for(var b=this.scenes[a].requirements,c=Object.keys(b),d=Object.keys(this.scenes[this.scene].choices),e=c.length,h=d.length,f=!0,g=!1,k=0;k<h;k++)if(d[k]===a){g=!0;break}if(!g)return!1;for(a=0;a<e;a++)if(d=c[a],void 0===this.items[d]){f=!1;break}else if(this.items[d]<b[d]){f=!1;break}return f?!0:!1};Novel.prototype.allMoves=function(){var a=this.scene.choices,b=[],c;for(c in a)this.canMove(c)&&b.push(c);return b};Novel.prototype.move=function(a){if(this.canMove(a))this.scene=a;else return!1};Novel.prototype.forceMove=function(a){this.scene=a};Novel.prototype.moveRandom=function(){var a=this.scenes[this.scene].choices;this.scene=Object.keys(a)[Math.floor(Math.random()*a.length)]};Novel.prototype.novelValidity=function(){var a=this.scenes,b=this.scene,c=typeof b;if("string"!==c&&"number"!==c)return[!1,"Scene "+b+" id is not a string or number"];b=!0;c="ERROR: Scene ";for(var d in a){var e=a[d],h;for(h in e)if("requirements"!==h&&"choices"!==h&&"description"!==h){b=!1;c+=d+" has an invalid property named "+h;break}if(!b)break;var f=e;e=f.requirements;var g=f.choices;f=f.description;if("object"!==typeof e||"object"!==typeof g||"string"!==typeof f||Array.isArray(g)||null===g){b=!1;c+=d+" has one or more of its 4 properties undefined or in the wrong type";break}if(!b)break;for(var k in g)if(f=typeof g[k],"string"!==f&&"number"!==f){b=!1;c+=d+" choice number "+(i+1)+" is not a string or number";break}if(!b)break;for(var l in e)if(g=typeof e[l],"string"!==g&&"number"!==g){b=!1;c+=d+" requirement "+l+" value is not a string or a number";break}if(!b)break}return b?[!0,"SUCCESSFUL"]:[b,c]};Novel.prototype.checkValidity=function(){var a=this.items,b=!0,c="ERROR: Item ",d;for(d in a){var e=typeof a[d];if("string"!==e&&"number"!==e){b=!1;c+=d+" value is not a string or a number";break}}return b?this.novelValidity():[!1,c]};Novel.prototype.cleanItem=function(a){delete this.items[a]};Novel.prototype.getChoices=function(){return this.scenes[this.scene].choices};Novel.prototype.getProperties=function(a){for(var b=a.length,c={},d=0;d<b;d++){var e=this[a[d]];e&&(c[a[d]]=e)}return c};
